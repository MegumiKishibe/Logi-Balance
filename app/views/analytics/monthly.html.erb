<div class="title-group">
  <div class="title">
    <p2>Analytics</p2>
    <p3>| 月次負荷ポイント推移</p3>
  </div>
</div>

<div class="dashboard-tabs">
  <%= link_to "単日", analytics_path, class: "dash-tab #{action_name == 'index' ? 'active' : ''}" %>
  <%= link_to "週次", weekly_analytics_path, class: "dash-tab #{action_name == 'weekly' ? 'active' : ''}" %>
  <%= link_to "月次", monthly_analytics_path, class: "dash-tab #{action_name == 'monthly' ? 'active' : ''}" %>
</div>

<div class="filter-section">
  <%= form_with url: monthly_analytics_path, method: :get, local: true, class: "field-row" do %>
    <label class="form-label">表示月：</label>
    <div class="select-wrapper">
      <%= select_tag :month,
            options_for_select(@months.map { |m| [m.strftime("%Y年%m月"), m] }, @month),
            onchange: "this.form.submit()",
            class: "form-select" %>
    </div>
  <% end %>
</div>

<div class="analytics-chart-panel">
  <%= line_chart @monthly_scores,
    curve: true,
    library: {
      scales: { y: { suggestedMax: @y_max } },
      plugins: {
        annotation: {
          annotations: {
            aboveAvg: {
              type: "box",
              xScaleID: "x",
              yScaleID: "y",
              xMin: @range_start,
              xMax: @range_end,
              yMin: @avg_value,
              yMax: @y_max,
              backgroundColor: "rgba(255, 23, 68, 0.08)",
              borderWidth: 0,
              drawTime: "beforeDatasetsDraw"
            }
          }
        }
      }
    } %>
</div>
