<div class="container">
  <div class="header">
    <h1>完了済み配達一覧</h1>
    <h2 lang="ja"><%= current_employee.last_name_ja %> さん</h2>
  </div>

  <div class="title-group">
    <div class="title">
      <p2>完了時間が早い順</p2>
      <p3>| Completed Deliveries</p3>
    </div>
  </div>

  <table class="table table-striped mt-3">
    <thead>
      <tr>
        <th>#</th>
        <th>コース</th>
        <th>配達先</th>
        <th>件数</th>
        <th>個数</th>
        <th>完了時間</th>
      </tr>
    </thead>

    <tbody>
      <% @delivery_stops.each_with_index do |stop, i| %>
        <tr>
          <td><strong><%= i + 1 %></strong></td>
          <td><%= stop.delivery.course.name %></td>
          <td><%= stop.destination.name %></td>
          <td><%= stop.packages_count %></td>
          <td><%= stop.pieces_count %></td>
          <td><%= stop.completed_at&.strftime("%H:%M") %></td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <div class="mt-3">
    <p>合計件数：<%= @total_packages %>件</p>
    <p>合計個数：<%= @total_pieces %>個</p>
    <p>時間：<%= format_duration(@work_seconds) %></p>
    <p>指針：<%= @distance_km.present? ? "#{@distance_km}km" : "-" %></p>
  </div>

  <div class="nav-button-group mt-4">
    <%= link_to "新規登録へ戻る",
                new_delivery_delivery_stop_path(@delivery || Delivery.order(id: :desc).first),
                class: "btn btn-primary" %>

    <%= button_to destroy_employee_session_path,
                  method: :delete,
                  form: { data: { turbo: false, turbo_confirm: "ログアウトしますか？" } },
                  class: "logout-button" do %>
      ログアウト
    <% end %>
  </div>
</div>
